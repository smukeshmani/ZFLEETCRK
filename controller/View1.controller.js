sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/m/MessageToast","sap/ui/core/library"],function(e,t,o,s,a,r,l,i){"use strict";return e.extend("ZGBC_FLEET_CLEARK.ZGBC_FLEET_CLEARK.controller.View1",{Date:{ArrivalDate:new Date},onInit:function(){this.oInputDate=new sap.ui.model.json.JSONModel(this.Date);this.getView().setModel(this.oInputDate,"InputDate")},onSubmit:function(){var e,t;t=this.getView();e=sap.ui.getCore().getMessageManager();t.setModel(e.getMessageModel(),"message");var o={Vehicleid:"",VehicleName:"",VehicleNumber:"",VehicleVendor:"",Plant:"",Location:"",CostCenter:""};this.oLocalVhModel=new sap.ui.model.json.JSONModel(o);t.setModel(this.oLocalVhModel,"localVhModel");var s={Plants:[],PlantSelected:null};this.oPlantDD=new sap.ui.model.json.JSONModel(s);t.setModel(this.oPlantDD,"localPlantDD");var a={Locations:[],LocSelected:null};this.oLocDD=new sap.ui.model.json.JSONModel(a);t.setModel(this.oLocDD,"LocDD");var r={SubmitVisibile:true};this.oLocVisible=new sap.ui.model.json.JSONModel(r);t.setModel(this.oLocVisible,"Visibility");var l=t.getModel();var i=this;var n=this.getView().byId("idRequestid").getValue();var c="/FleetRequestHeaderSet('"+n+"')";l.read(c,{urlParameters:{$expand:"RequestHeaderToItemNav"},success:function(e,t){var o=new sap.ui.model.json.JSONModel(e);var s=i.getView().byId("IdEmpDetail");s.setModel(o);c="/VehicleDetails2Set('"+n+"')";l.read(c,{success:function(e,t){i.oLocalVhModel.setProperty("/Vehicleid",e.VehicleId);i.oLocalVhModel.setProperty("/VehicleName",e.VehicleText);i.oLocalVhModel.setProperty("/VehicleVendor",e.VehicleVendor);i.oLocalVhModel.setProperty("/VehicleNumber",e.VehicleNo);i.oLocalVhModel.setProperty("/Plant",e.VehiclePlant);i.oLocalVhModel.setProperty("/Location",e.VehicleLoc);i.oLocalVhModel.setProperty("/CostCenter",e.VehicleCc);c="/PlantDropDownSet";var o="RequestId eq '"+n+"'";l.read(c,{urlParameters:{$filter:o},success:function(e,t){i.oPlantDD.setProperty("/Plants",e.results);i.oPlantDD.setProperty("/PlantSelected",e.results[0].Plant);var s=e.results[0].Plant;c="/LocationDropDownSet";o="Plant eq '"+s+"'";l.read(c,{urlParameters:{$filter:o},success:function(e,t){i.oLocDD.setProperty("/Locations",e.results);i.oLocDD.setProperty("/LocSelected",e.results[0].LocationId)},error:function(){sap.m.MessageToast.show("No Data retreived")}})},error:function(e){var t=jQuery.parseJSON(e.responseText).error.message.value;sap.m.MessageToast.show(t);return}})},error:function(){i.oLocalVhModel.setProperty("/Vehicleid","");i.oLocalVhModel.setProperty("/VehicleName","");i.oLocalVhModel.setProperty("/VehicleVendor","");i.oLocalVhModel.setProperty("/VehicleNumber","");i.oLocalVhModel.setProperty("/Plant","");i.oLocalVhModel.setProperty("/Location","")}})},error:function(e){var t=jQuery.parseJSON(e.responseText).error.message.value;sap.m.MessageToast.show(t);return}})},onSelectPlant:function(e){var t=this.getView().getModel("localPlantDD").getProperty("/PlantSelected");var o=this.getView().getModel();var s="/LocationDropDownSet";var a="Plant eq '"+t+"'";var r=this;o.read(s,{urlParameters:{$filter:a},success:function(e,t){r.oLocDD.setProperty("/Locations",e.results)},error:function(){sap.m.MessageToast.show("No Data retreived")}})},onSubmitRequest:function(){var e=this.getView().byId("idRequestid").getValue();var t=this.getView().byId("IdSelectedPlant").getSelectedKey();var o=this.getView().byId("IdSelectedLoc").getSelectedKey();var s=this.getView().byId("idShname").getValue();var a=this.getView().byId("idCost").getValue();var r=this.getView().byId("idContact").getValue();var l=this.oInputDate.getProperty("/ArrivalDate");var i=l.getDate();var n=l.getMonth();var c=l.getFullYear();var d=i+"-"+n+"-"+c;var u={RequestId:e,ShipToPlant:t,ShipToLoc:o,NameOfShipper:s,Cost:a,ShipperContact:r,ExDate:d};var h=this.getView().getModel();var V=this;h.create("/SubmitFLCSet",u,{success:function(e,t){sap.m.MessageToast.show("Shipment Details Has been successfully");V.getView().getModel("Visibility").setProperty("/SubmitVisibile",false)},error:function(e){sap.m.MessageToast.show("Unable to Save the Data");return}})}})});